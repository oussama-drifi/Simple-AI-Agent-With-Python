<!DOCTYPE html>
<html>
<head>
    <title>Test Task API</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { margin: 5px; padding: 10px; }
        .result { 
            background: #f5f5f5; 
            padding: 10px; 
            margin: 10px 0; 
            border: 1px solid #ddd;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Test Task API</h1>
    
    <div>
        <h3>1. List Tasks</h3>
        <button onclick="listTasks()">GET /api/tasks</button>
        <div id="listResult" class="result"></div>
    </div>
    
    <div>
        <h3>2. Create Task</h3>
        <input type="text" id="taskTitle" placeholder="Task title" value="Buy groceries">
        <input type="text" id="taskDesc" placeholder="Description" value="Milk, eggs, bread">
        <button onclick="createTask()">POST /api/tasks</button>
        <div id="createResult" class="result"></div>
    </div>
    
    <div>
        <h3>3. Update Task</h3>
        <input type="number" id="updateId" placeholder="Task ID" value="1">
        <input type="text" id="updateStatus" placeholder="New status" value="in progress">
        <button onclick="updateTask()">PUT /api/tasks/{id}</button>
        <div id="updateResult" class="result"></div>
    </div>
    
    <div>
        <h3>4. Delete Task</h3>
        <input type="number" id="deleteId" placeholder="Task ID" value="1">
        <button onclick="deleteTask()">DELETE /api/tasks/{id}</button>
        <div id="deleteResult" class="result"></div>
    </div>
    <div>
        <h3>5. Chat with AI</h3>
        <input type="text" id="user_prompt" placeholder="type something">
        <button onclick="postChatMessage()">POST /api/chat</button>
        <div id="chatResult" class="result"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';
        
        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.innerHTML = JSON.stringify(data, null, 2);
            element.className = `result ${isError ? 'error' : 'success'}`;
        }

        async function postChatMessage() {
            const prompt = document.getElementById("user_prompt");
            try {
                const response = await fetch(`${API_URL}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_prompt: prompt
                    })
                });
                const data = await response.json();
                showResult('chatResult', data, !response.ok);

            } catch (error) {

            }
        }
        
        async function listTasks() {
            try {
                const response = await fetch(`${API_URL}/tasks`);
                const data = await response.json();
                showResult('listResult', data, !response.ok);
            } catch (error) {
                showResult('listResult', { error: error.message }, true);
            }
        }
        
        async function createTask() {
            const title = document.getElementById('taskTitle').value;
            const description = document.getElementById('taskDesc').value;
            
            try {
                const response = await fetch(`${API_URL}/tasks`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: title,
                        description: description
                    })
                });
                const data = await response.json();
                showResult('createResult', data, !response.ok);
            } catch (error) {
                showResult('createResult', { error: error.message }, true);
            }
        }
        
        async function updateTask() {
            const taskId = document.getElementById('updateId').value;
            const status = document.getElementById('updateStatus').value;
            
            try {
                const response = await fetch(`${API_URL}/tasks/${taskId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        status: status
                    })
                });
                const data = await response.json();
                showResult('updateResult', data, !response.ok);
            } catch (error) {
                showResult('updateResult', { error: error.message }, true);
            }
        }
        
        async function deleteTask() {
            const taskId = document.getElementById('deleteId').value;
            
            try {
                const response = await fetch(`${API_URL}/tasks/${taskId}`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                showResult('deleteResult', data, !response.ok);
            } catch (error) {
                showResult('deleteResult', { error: error.message }, true);
            }
        }
        
        // Initial list of tasks
        listTasks();
    </script>
</body>
</html>